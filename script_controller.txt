#!/bin/bash

# Update and upgrade the system
sudo apt-get update -y && sudo apt-get upgrade -y

# Install required packages
sudo apt-get install net-tools -y
sudo apt install munin apache2 -y
sudo apt install syslog-ng -y
sudo apt-get install mariadb-server -y
sudo apt-get install libmariadbclient-dev -y
sudo systemctl start mariadb
sudo systemctl enable mariadb


# Display syslog-ng status
sudo systemctl status syslog-ng

# Append syslog-ng configuration
cat <<EOL | sudo tee -a /etc/syslog-ng/syslog-ng.conf
options {
  flush_lines (0);
  time_reopen (10);
  log_fifo_size (1000);
  chain_hostnames (off);
  use_dns (no);
  use_fqdn (no);
  create_dirs (no);
  keep_hostname (yes);
};

source s_net {
  system();
  internal();
};

destination d_logs {
  file("/var/logsvanminions.log");
};

log {
  source(s_net);
  destination(d_logs);
};
EOL

# Restart syslog-ng to apply the changes
sudo systemctl restart syslog-ng

# Add Minion(s) to Munin configuration
echo "[Minion-Jelle]
    address 10.0.0.28
    use_node_name yes" | sudo tee -a /etc/munin/munin.conf

# Restart Munin to apply the changes
sudo systemctl restart munin


